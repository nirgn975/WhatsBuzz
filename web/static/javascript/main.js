"use strict";function checkLoginState(){FB.getLoginStatus(function(e){statusChangeCallback(e)})}function statusChangeCallback(e){"connected"===e.status?(getPermissions(),setFbButtonToShare()):("not_authorized"===e.status,loginFBpopup())}function setFbButtonToShare(){$(".loginBtn--facebook").text("שתף בפייסבוק")}function loginFBpopup(){FB.login(function(e){"connected"===e.status&&(getPermissions(),setFbButtonToShare())},{scope:"user_posts, user_about_me, user_tagged_places, user_relationships, user_birthday, user_status, user_likes",return_scopes:!0})}function getPermissions(){var e=$(".loginBtn--facebook").data();if(!$(".loginBtn--facebook").hasClass("loading")){$(".loginBtn--facebook").addClass("loading"),showSpinner();var t=new Promise(function(t,a){var s=$("#facebooklogin").data("post");JSON.stringify(e)==JSON.stringify({profile_image:!0,full_user_name:!0})?$.get("/posts/get_data/user_name/"+s,function(e){FB.api("/me",{fields:"name"},function(e){e&&!e.error&&t({text:e.name,image:"http://graph.facebook.com/"+e.id+"/picture?type=large"})})}):JSON.stringify(e)==JSON.stringify({profile_image:!0,first_user_name:!0})?$.get("/posts/get_data/user_name/"+s,function(e){FB.api("/me",{fields:"first_name"},function(e){e&&!e.error&&t({text:e.first_name,image:"http://graph.facebook.com/"+e.id+"/picture?type=large"})})}):JSON.stringify(e)==JSON.stringify({profile_image:!0,last_user_name:!0})?$.get("/posts/get_data/user_name/"+s,function(e){FB.api("/me",{fields:"last_name"},function(e){e&&!e.error&&t({text:e.last_name,image:"http://graph.facebook.com/"+e.id+"/picture?type=large"})})}):JSON.stringify(e)==JSON.stringify({profile_image:!0})?$.get("/posts/get_data/profile_image/"+s,function(e){FB.api("me/picture?type=large",function(e){e&&!e.error&&t({image:e.data.url})})}):JSON.stringify(e)==JSON.stringify({full_user_name:!0})?$.get("/posts/get_data/user_name/"+s,function(e){FB.api("/me",{fields:"name"},function(e){e&&!e.error&&t({text:e.name})})}):JSON.stringify(e)==JSON.stringify({first_user_name:!0})?$.get("/posts/get_data/user_name/"+s,function(e){FB.api("/me",{fields:"first_name"},function(e){e&&!e.error&&t({text:e.first_name})})}):JSON.stringify(e)==JSON.stringify({last_user_name:!0})&&$.get("/posts/get_data/user_name/"+s,function(e){FB.api("/me",{fields:"last_name"},function(e){e&&!e.error&&t({text:e.last_name})})})});t.then(function(e){getImageGame(e.text,e.image)},function(e){console.log(e)})}}function showSpinner(){$(".loader").append($("<img>").attr("src","/static/images/spinner.svg").css("animation","spin 5.250s infinite ease").css("margin","25px").css("width","30%")),$(".loader").delay(5e3).fadeOut(250)}function getImageGame(e,t){console.log(e),$.ajax({url:"/create-image/",success:function(e){$(".loader").hide(),$(".loginBtn--facebook").addClass("fb-share").removeClass("loading"),$("#FB-image-game").attr("src","/users_photos/"+e[0].image_name+".jpg").show()},error:function(e){console.log("error2")},data:{slug:window.location.href.split("/")[window.location.href.split("/").length-2],name:e,image:t}})}function shareThisPost(){var e=$(location).attr("href"),t=$("#post-title > h2").text(),a=$("#description").text(),s=e.split("/")[0]+"//"+e.split("/")[2],n=s+$("#FB-image-game").attr("src");FB.ui({method:"share",title:t,picture:n,href:e,hashtag:"#WhatsBuzz",link:s,description:a,caption:"http://www.whatsbuzz.co.il",display:"popup"},function(e){e&&e.post_id?console.log("share success"):console.log("share error")})}window.fbAsyncInit=function(){FB.init({appId:"1063610257017045",cookie:!0,xfbml:!0,status:!0,version:"v2.5"})},function(e,t,a){var s,n=e.getElementsByTagName(t)[0];e.getElementById(a)||(s=e.createElement(t),s.id=a,s.src="//connect.facebook.net/en_US/sdk.js",n.parentNode.insertBefore(s,n))}(document,"script","facebook-jssdk"),"undefined"!=typeof FB&&null!=FB;var MEDIA_URL="/staticuploads/";$(".loginBtn--facebook").click(function(){event.preventDefault(),$(this).hasClass("fb-share")?shareThisPost():checkLoginState()}),$("#quizzes-game").click(function(){$("#facebooklogin").hide(),showSpinner(),setTimeout(function(){$("#quizzes").show()},5250)}),$("#show-more-in-page").click(function(e){e.preventDefault();var t=$(".show-more").data("posts-type"),a=$(".posts").length;$.get("/get-more-posts/"+t+"/"+a,function(e){var e=JSON.parse(e[0].posts);e.forEach(function(e){var t=$("<h2>").text(e.fields.title),a=$("<img>").addClass("banner-image").attr("src",MEDIA_URL+e.fields.image_banner).attr("alt",e.fields.image_banner),s=$("<a>").attr("href","/posts/"+e.fields.slug).append($("<div>").addClass("row link").append($("<p>").text("התחל משחק"))),n=$("<div>").addClass("col-sm-6 posts").append($("<div>").addClass("post").append(t).append(a).append(s));$("#main-posts").append(n)})})});